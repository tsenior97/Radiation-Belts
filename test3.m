R_E=6370000;
m=1.6726e-27;
q=1.6022e-19;
B_0=3.15e-5;
k_0=B_0*(R_E)^3;
E=[-1,-1,-1];
g=[0,0,0];
f=@(t,v)[v(4);v(5);v(6);
    q/m*(v(5)*((k_0/(sqrt(v(1)^2+v(2)^2+v(3)^2))^3)*(1-3*cos(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))^2))-v(6)*(-3*k_0/(sqrt(v(1)^2+v(2)^2+v(3)^2))^3*cos(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*sin(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*sin(atan(v(2)/v(1))))+E(1))+g(1);
    q/m*(v(6)*(-3*k_0/(sqrt(v(1)^2+v(2)^2+v(3)^2))^3*cos(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*sin(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*cos(atan(v(2)/v(1))))-v(4)*((k_0/(sqrt(v(1)^2+v(2)^2+v(3)^2))^3)*(1-3*cos(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))^2))+E(2))+g(2);
    q/m*(v(4)*(-3*k_0/(sqrt(v(1)^2+v(2)^2+v(3)^2))^3*cos(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*sin(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*sin(atan(v(2)/v(1))))-v(5)*(-3*k_0/(sqrt(v(1)^2+v(2)^2+v(3)^2))^3*cos(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*sin(acos(v(3)/sqrt(v(1)^2+v(2)^2+v(3)^2)))*cos(atan(v(2)/v(1))))+E(3))+g(3)];
opts=odeset('RelTol',1e-13,'AbsTol',1e-15);
[t,va]=ode45(f,[0 20],[3*R_E 0 0 100000 0 100],opts);
plot(va(:,1),va(:,3))
xlim([0,6370000*4])
grid on